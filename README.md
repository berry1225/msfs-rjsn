# msfs-rjsn

作成に使ったファイルを置きました。
空港の情報は rjsn_asset/RJSN_Scene.xml の中に色々保存しています。都度参照してください。

scenery周辺のことはmsfs-niigataの方を参照してください。今回もGoogle地図由来の画像ファイルはgit管理を省いています。
また、マテリアルについても同様にgit管理を省いています。

## まえがき

デフォルトの空港だと変なところがスポット扱いになっていて、勝手に飛行機が置かれて移動の邪魔になることがあります。
(RJSNはその最たる例で、誘導路からエプロンに入る場所が全ヶ所スポット扱いになっている)

なので、正しい情報に修正してやる必要があります。
しかし現状ではエディット機能のようなものはなく、完全ハンドメイドで作成して上書きするしかないようです。

とはいえ、フルスクラッチで作成するのは大変なので、まずはデフォルトの空港からファイルを抽出します。
抽出には「Airport2Project」を使用しました。(現時点の最新は以下でした、都度最新のファイルを探してからダウンロードを推奨)
https://www.fsdeveloper.com/forum/threads/official-airport-to-sdk-project-here-is-a-small-app-to-help-you-draft.450344/

ILSとか照明の位置とかの各情報は、[AIS JAPAN](https://aisjapan.mlit.go.jp/Login.do)に載っているデータを参照しました。要会員登録ですが無料で見れます。
自衛隊エリアのスポット名などは分からなかったので、自前で適当な数値を指定しました。


## 手順

Airport2Project(v1.0.0.3)で抽出後にやったことは以下です。細かい修正は他にも色々やっています。
* ILSを無効にして自作 (Airport2Project v1.0.0.5aあたりでこのへんの作業は不要になった模様？)
* RunwayのApproach lightが眩しすぎるので修正 (作成時点ではRW28側はPALS、RW10側はSALSだったので、それっぽく修正)
* RunwayのPAPIの位置を修正
* デフォルトの吹き流しを無効にして新規配置
* 誘導路名を修正
* エプロン用の照明を追加
* 南エプロン拡張に伴って最新の状態に変更(v2.0)
* 滑走路オレンジ化(v2.0)

### Parking

parkingはtaxi pathで繋いでやらないとルート認識されないようです。
直前までtaxi用のpathを作って、直前のpointとparkingを選択した状態で右クリックメニューからパスを接続するといい感じになります。

vehicleのparkingからvehicle用のtaxiwayを引いていい感じに繋がないと給油とかしてくれないようです。忘れずに。

### Jetway

Jetwayがターミナルと繋がってないので、sceneryで「ramp」とかで適宜検索していい感じに配置して繋げます。
このファイルではsceneryごとGoogle地図から引っ張ってきたオブジェクトに置き換えています。
近くで見るとなかなか見栄えが悪いので、Blenderとかでスクラッチして置き換えたいなとか考えています。面倒なので誰か汎用品を作って欲しいです。

### ILS

※Airport2Project v1.0.0.5aあたりでこのあたりの設定も一緒に出力してくれるようになったみたいです。この項は一般的なことも書いているので一応残しておきます。

ILSは「然るべき名前を使って作成すると認識してくれる」タイプのようです。
RJSNの場合は「ILS RW28」が然るべき名前でした。実際にバニラの状態でA320neoなどを飛ばしてみると確認できます。

AIS JAPANの資料に色々載ってるのでそれを見ながらILSの情報を入力します。
資料(チャート)の見方はプロに聞くかプロ用の教材で確認してください。
~わたしはプロじゃないのでフィーリングでやりました。~

各項目をちゃんと設定しないと、Little Navmapなどのソフトウェアで見た時に誤った情報が表示されるようです。特にMagvarとIdent。

|項目|推奨設定|RJSN RW28|RJCC RW19L|説明|
|--|--|--|--|--|
|Primary ILS|as required|v|v|どっちがプライマリ側かはVASI(PAPI)や進入灯の設定いじれば確認できる。たぶんScenery Editorで表示されている方がプライマリ。|
|Friendly name|適切な名称|ILS RW28|ILS RW19L|然るべき名前で入力する必要あり。バニラ状態でILS着陸する時に確認できる。「ILS RW○○」が正解？|
|Edit position|as required|as required|as required|ILSを移動させるかどうか。基本的には終端側(つまりLOCの場所)に配置する。資料見ながら配置。|
|Frequency|適切な数値|109300000|109350000|周波数。滑走路ごとに異なる。メガヘルツになるようにゼロをたくさん足す。(微妙に端数が合わなくても気にしない)|
|Ident|適切なID|INC|ICM|資料の「ID」の欄に書いてある文字列を入れる。Little Navmapでも確認可。|
|Magvar|適切な度数|8.2|9.6|「方位磁石の北」と「実際の北」のズレ。チャートにも書いてあるが、Little Navmapで見てみるのが早い。Westの方向がプラス。|
|Heading|適切な角度|281|182|滑走路の方角。360度単位。|
|Enable range| | | |距離を有効にするかどうか。現実のRJSNは14NMっぽかったけれどチェックなし。|
|Enable beam width|v|v|v|幅を有効にするかどうか。|
|Beam width|5|5|5|幅。±5度で合計10度になるのが一般的、一応資料も見る。|
|BackCourse|?|v| |どうなるのかよく分かってない。|
|Has DME|v|v|v|DMEがあるかどうか。あるならチェック|
|DME - Edit position|as required|as required|as required|DMEの場所を指定。資料見ながら配置。|
|DME - Range|18540|18540|18540|距離の指定。10NMが一般的、一応資料も見る。|
|Has glide slope (GS)|v|v|v|グライドスロープ(GS,GP)があるかどうか。あるならチェック。|
|GS - Edit position|as required|as required|as required|GS用アンテナの場所を指定。資料見ながら配置。|
|GS - Range|18540|18540|18540|距離の指定。10NMが一般的、一応資料も見る。|
|GS - Pitch|3？|3|3|進入角度。3度が一般的だがRJCJは2.7度、資料見ながら設定。ちなみにロンドンシティ(EGLC)は5.5度らしい。|
|Secondary ILS|as required| |v|セカンダリ側にILSが存在する場合は設定を続ける。|
|...|as required||RW01Rの設定|以下、セカンダリ側の設定が必要な場合は同じ項目が続く。|

できたら実際に飛ばしてデバッグしてみる。ちゃんと着陸できればOK。
**この作業が最高に面倒くさい。**
~~なんならv1.2の修正時は飛んでない。~~

LOCとかDMEとか何？というのは[Wikipediaの計器着陸装置のページ](https://ja.wikipedia.org/wiki/計器着陸装置)でも見れば分かりやすいと思います。

* LOC：ローカライザー。滑走路が水平方向360度のどっちにあるかを示すためのもの。滑走路終端側にある。
* DME：距離測定装置。着陸する場所までの距離を示すためのもの。だいたい着陸帯の横にある。
* GS：グライドスロープ。GP(グライドパス)とも言われる。進入角を示すもの。だいたい着陸帯の横にある。

「全部着陸帯に置けばいいのに」と思うかもしれませんが、現実世界では以下のような理由で「無視できる方向」にずらして置かれています。
* LOC：方向さえ分かればいいやつなので、滑走路終端に置く。(滑走路に置くと邪魔だし･･･)
* DME：着陸帯までの距離さえ分かればいいやつなので、邪魔にならないようにその真横あたりに置く。
* GS：着陸帯を高度0とした時の進入角さえ分かればいいやつなので、邪魔にならないように着陸帯の真横あたりに置く。

ちなみに、それぞれ「正しい方向から進入した時」しかキャプチャできないように有効範囲が設定されています。rangeとかbeam widthの設定項目のあたりですね。
なので滑走路の真正面から入ってきた時は「LOCはあっちだからそっちに進めば滑走路だ」となりますが、真横から滑走路を見た時にはLOCはキャプチャできません。
交差点で真正面の信号機が見やすく、真横の信号機が見えない(もしくは紛らわしい場合にわざとカバーで覆って見えないようにしてある)のと原理としては同じですね。

### 吹き流しの移動

吹き流しが事実とは違うところに立っている場合、ありますよね。直接は動かせないので「新しい吹き流しを配置」と「古い吹き流しの除去」が必要です。

まずSceneryで「Windsock」を配置します。
**編集画面ではオブジェクトが見えない気がしても、パッケージにすればちゃんと反映されます。**

古い吹き流しは、ExclusionRectangleで囲ってあげると消えます。
**編集画面では消えないような気がしても、パッケージにすればちゃんと反映されます。**
~~あれ、さっきも同じようなことを書いたような･･･~~

で、ここからが重要なんですが、
**配置直後はheadinが180°(-180°)になっています。これを必ず0に変えてください。**
180°のままだと、風の向きと逆向きに吹き流しが流れてしまうようです。(少なくとも2021年5月時点では)

画像などは[Twitterの該当投稿参照](https://twitter.com/usagiair/status/1396443904946237446)。

## その他のTIPS

### TIPS：グループ化
オブジェクトは種類ごとにグループ化しておくといいです。何故かと言うと、高頻度で「Aplonが邪魔！！」「Path邪魔！！」「Point邪魔！！」となるのでいちいち非表示にしないとダルくて先に進めないからです。
(以前のバージョンではAirportのデータは特に何もしなくても種類ごとに勝手にグループが分かれていたので、グループ化しなくてもいっせいに非表示にできた)

やり方：Shift押しながら複数選択→右クリック→「Group With ...」→グループ名を指定して「Create New Group」

SDK v0.13.0時点では、「表示/非表示」だけでなく「選択可/選択不可」も選べるようになっているようです。
なので「表示したまま選択不可にする」という芸当も可能になっています。

### TIPS：滑走路周辺の地形編集
Runway周辺の地形が平坦になって困ったことありませんか？
わたしは･･･あまりありませんが、他の人は結構困ってました。

Runwayのオブジェクトは、滑走路を描画する際に周りの地形で不整合が出ないように高さを調整しているみたいです。
デフォルトではその範囲がとても広いことになっているので、周囲が丸ごと平坦になってしまうようです。

解決方法としては、プロパティの「falloff distance」に1とか5とか小さい数字を入れればOKです。

そもそも滑走路を平坦じゃなくするには、Airport Flatten(だったかな？)をオフにするといいみたいです。他にも設定が必要かもしれませんが。

### TIPS：飛行場灯台

Sceneryから「RotatingBeacon_Tower」を選択して配置します。
「Has Beacon」にチェックをします。
「Beacon Base」は「Airport」を指定します。

Gizmoを調整して、対象のオブジェクトが限りなく小さくなるように調整します。
(Scaleを0.01とかにして元のタワーのオブジェクトが表示されないようにする、光源の情報は変わらない)

元の飛行場灯台がある場合は、ExclusionRectangleで囲ってあげて除外します。

この状態だと高さがズレたままになるので、一旦パッケージをビルドして、パッケージをCommunityフォルダに入れた状態でMSFSを起動します。位置ズレに応じて位置を調整します。
あとは高さのズレとの闘いです。ひたすら修正とビルドと確認を繰り返します。運がよければ2回目くらいでピッタリ合うと思います。頑張ってください。

※「RotatingBeacon_Tower」以外のオブジェクトでも「Has Beacon」の指定は可能なようですが、おまじないや名称の明瞭性なども含めて「RotatingBeacon_Tower」を指定することをオススメします。

### TIPS：シーナリーの名前
わたしの作成した素材は、名前の頭に「berry_」とつけています。そうすると自分で使う時も分かりやすいですし、誰かにとっても「これはberryの作ったファイルだ」と除けやすくなります。
なので、思いやり程度にオリジナル接頭辞をつけておくことをオススメします。

### TIPS：誘導路の灯火
誘導路の中心線の部分ある灯火については、TaxiPathに「Center line lighted」があるので、それをチェックする。

誘導路の端にある灯火については、3パターンくらい実装方法がある。
* "TaxiPath"で"Left (Right) edge lighted"を指定することでそれぞれ光らせることが可能。
* * とはいえ、どっちが左でどっちが右だよ！というツッコミで悩まされることは間違いなし。
* "PaintedLine"で「LIGHT」のつくものを選択。
* "LightRow"オブジェクトを配置する。配置方法はPaintedLineと同じでCtrl+クリック。

**3つめの"Light row"を使う方法は知りませんでした。**
わざわざ透明な線を作ってPaintedLineを光らせてましたよ･･･

とはいえ、個人的には通常時はPaintedLineを光らせる方法を推奨します。線のないところに必要な場合はLight rowを使う感じで。
TaxiPathはいつぞやのアップデートで一面青い海になった苦い思い出があるので非推奨。でも間隔が最も狭くなるのが魅力的。

### TIPS：Bingの航空写真と最新のデータが異なる場合

RJSNの南のスポット、なんか最新のチャートと比べると猫の額くらい狭いなーと思ったら、
Bingの航空写真の時点(2015年くらい？)から移設していたことが判明しました。
[参考Tweet](https://twitter.com/usagiair/status/1397544698475020288)

めんどいなぁ、とは思いつつも、Google Mapsの方に2019年くらいのデータがちょうどあったので、それを下敷きにすることにしました。めちゃくちゃラクでした。絵に限らず補助線は正義。
[参考Tweet](https://twitter.com/usagiair/status/1397567533494902791)

マテリアル化の詳しい手法については、[滑走路オレンジ化](https://github.com/berry1225/msfs-orange-materials)の方に詳しく書いてあるのでこちらでは割愛します。

古い航空写真が透けて見える箇所については、Apronを新規作成してDirtとかの素材を当てはめて(現実でも土が見えている状態ですし)、うまく航空写真が見えないようにしました。
航空写真が更新されたらそこも必要なくなるのでしょうか、とは思いますがいつMSFS内で更新がくるのかは不明なので、今はそこまで考えなくていいですね。

自衛隊のスポットの線も同じ方法でスイスイ作成できました。Bingの航空写真が古くてGoogle等の他サービスに新しいものがある場合は、この方法を使用することを推奨します。
ちなみに、福岡空港あたりはGoogle Mapsでも追従できておらず、最新のチャートの情報を参照できずにまりんさんが悲鳴を上げていました。その場合は手動で補助線を引くしか無いですね。
[参考Tweet](https://twitter.com/marinflyer/status/1383426038525431813)

なお、わたしはMSFT信者なので、Bingのことを悪く言うつもりはありません。鳥観図どこ行った？とは思いますが。

### TIPS：駐機場の並び順 (上級編)

**ファイルを直接弄る必要があるのであまり推奨しません。編集前のXMLファイルは必ずバックアップしましょう。**

World Mapから見た時に、空港のスポット一覧の並び順が滅茶苦茶でした。

実はこれ、Parking要素のindexの数字の昇順に並んでいるようです。
しかし、SDK上ではindexの数字は変更できません。(単にSDKでの並び順(groupIndex)を変えただけでもダメです)

なので、xmlファイルをエディタで開いて直接弄る必要があります。必ずバックアップするようにしましょう。

indexはTaxiwayPointと通し番号になっていて、TaxiwayPathでも使っています。
なので、単にParkingのindexを番号順に変えた変えただけだと、パスが滅茶苦茶になってしまいます。

そのため、被りのないような大きな番号(601～とか？)を以下のそれぞれ対応する部分に置換してやりましょう。[参考Tweet](https://twitter.com/usagiair/status/1397922711498760200)
* Parking要素の"index"
* TaxiwayPath要素の"end"の部分

RJSNの場合は300くらいまでしかindexを使ってなかったので、以下の番台で番号若い順から割り振ってます。興味のある方はアップロードしてある生ファイルなども参照してみてください。
* GATE5-8：500番台
* スポット1-10：510番台
* スポットS1-S14：550番台
* 自衛隊のスポット：600番台
* 自動車用のスポット：690番台

## 課題

### 課題：線の色の話
北日本の滑走路は、降雪時の視認性確保のために線がオレンジ色になっていることが多いです。本物のRJSNもオレンジ色です。
ですが、機能として「線をオレンジ色」みたいに選ぶことは現状できないので、material登録とかでいい感じにする必要がありそう。
(いくつか作例もあるようなので実現はできそう、しかし方法が不明瞭)

[Marinさん](https://flightsim.to/profile/Marin)は、[この動画](https://www.youtube.com/watch?v=bz5VfVs17xo&t=36s)を参考にして線の色をオレンジに変えてました。

[KAZEさん](https://flightsim.to/profile/KAZE)は、デフォルトの素材を使って滑走路をオレンジにしていました。[ブログ参照](https://ameblo.jp/fs2020/entry-12668787266.html)。この方法だと太いラインとかが使えません。

→v2.0でオレンジ色にしました。[オレンジ色にする話はこっちに詳しく書きました](https://github.com/berry1225/msfs-orange-materials)。

### 課題：滑走路のホットスタート位置
v2.0時点で、RW10-28の滑走路上からプレイする場合に、スタート位置の設定がおかしい気がしてます。
具体的に言うと、B747のような大型機の場合に前に出過ぎてしまう。(そして大型機ゆえに滑走距離が足りずに離陸できなくなる) [参考Tweet](https://twitter.com/usagiair/status/1399349864807297028)

まぁ新潟でそんな図体でかい機体に乗ってんじゃねーよでファイナルアンサーなんですが、純粋に不具合なので困ってます。
以下やったこと
* Blast pad、thresholdあたりの設定を有効にする →直らない (長さを設定してもダメ)
* Runway startの位置を変更する →直らない
* Runway startを一回削除して再度設置 →直らない
* Taxiway Pathを真ん中で分割してみる →直らない
* AirportのDisable All Start的なやつの指定を無効にする **→ATCが離陸許可を出してくれなくなる不具合誘発** ~~一度やらかして学習したのにどうして･･･~~

他にも色々やった気がしますが、確実性が無いのでやめておきます。
B747の場合はだいたい500mくらいズレていて、機体ごとにその幅が違っていたので、
何かしらの設定で掛け算して導き出しているのかな？という気はしています。 [参考Tweet](https://twitter.com/usagiair/status/1399406018589708293)

ただ、既存の設定でいじれるところは基本設定以外はいじったので、うーん･･･
滑走路の幅は一度こっそり43m弱から45mに変えたんですが、今回の検証では何もいじってないので、あと試すとしたらそのあたり？

あくまで2500mのRW10-28の滑走路でのみ発生しているので、
1300m強のRW04-22の滑走路では問題なさそうでした。もしくは変動幅が気付かないレベルの幅になっていそうです。

こればっかりは調べても何も出てこなかったので、コミュニティがうまく解決してくれることを希望します。

### 課題：エプロンやマーキングの色指定が変わらない

わたしの環境で起こった問題です。解決したんですが、一応メモ残しておきます。

開発者モード → Options → Airports → Airports Coloring をOFFにしたままの人はエプロンやマーキングの色指定が無効になるみたいでした。[参考リンク](https://www.fsdeveloper.com/forum/threads/enable-coloration-in-apron-properties-stopped-working.450644/)

このへんの表示はDevモードをOFFにした後も継続してた気がするので注意が必要です。それってどうなの？とは思うんですが。

### 課題：シーナリーの話
sceneryなどのファイルはデフォルトのものの他、Communityフォルダに入っているものやマケプレでダウンロードしたコンテンツのものも使用できるようです。
しかし個人で楽しむならともかく、誰かに配布する前提のファイルで有料アドオンの素材を使用するのは厳禁です。
(もっとも、固有の空港のターミナルなど他に使いまわしが利かなそうなものが多い上に、相手もその有料アドオンを所有していなければ表示されないとは思いますが)

RJCK(釧路)やRORS(下地島)のファイルも便利そうなのがいくつかありましたが、デフォルトのものだけを使用するようにしています。
(日本アップデートの追加ファイルをダウンロードしていない人がいたら、それらに付属するオブジェクトも反映されないと思われるため)
ファイル管理の仕様について詳しい人がいたら日本語wikiとかどこかに書いてください。

ただ、Communityフォルダの中身は適宜退避させれば除けることができますが、マケプレでダウンロードしたコンテンツは一旦ゲーム内から削除しないとダメそうです。
マケプレ由来のデータは削除するのが面倒だったので、選ぶ時に選ばないように気を付ける、くらいで手動で除けました。

先述のとおり、わたしの作成した素材は「berry_」と頭につけています。そうすると自分で使う時も分かりやすいですし、誰かにとっても「これはberryの作ったファイルだ」と除けやすくなります。

---

チョコレートか金平糖が足りてたら追記します。

`Buy me chocolate`
